<link rel="stylesheet" href="css/makeNewCharacter.css?rand=sdfsdddxxxxdcc" type="text/css"><script type="text/javascript">function checkTextAreaScrolling(textarea) {  if (textarea.clientHeight < textarea.scrollHeight && $(textarea).css("border-top-right-radius") == "5px") {    $(textarea).css("border-top-right-radius", "0px");    $(textarea).css("border-bottom-right-radius", "0px");  } else if (textarea.clientHeight >= textarea.scrollHeight && $(textarea).css("border-top-right-radius") == "0px") {    $(textarea).css("border-top-right-radius", "5px");    $(textarea).css("border-bottom-right-radius", "5px");  }}$(document).ready(function() {  var topDivID = generateDivID("newCharacterParent");  $(document.getElementById("newCharacterParent")).attr("id", topDivID);  var topDiv = document.getElementById(topDivID);  $(topDiv).find("#newCharacterDesc").bind('input propertychange', function() {    checkTextAreaScrolling(this);  });  $(topDiv).find("#newCharacterBackground").bind('input propertychange', function() {    checkTextAreaScrolling(this);  });  $(topDiv).find("#newCharacterPrivate").bind('input propertychange', function() {    checkTextAreaScrolling(this);  });  var dcb = getDCBFromChild(topDiv);  $(topDiv).find("#newCharacterBtn").attr("onClick", "javascript:submitCharacter('" + topDivID + "');");  setTimeout(dcb.checkScrollers, 500, $(topDiv));  var dropBox = $(topDiv).find("#newCharacterDropBox");  var img = $(topDiv).find("#newCharacterPreview");  $(img).data("topDiv", $(topDiv));  dropBox = dropBox[0];  dropBox.addEventListener("dragenter", noopHandler, false);  dropBox.addEventListener("dragexit", noopHandler, false);  dropBox.addEventListener("dragover", noopHandler, false);  dropBox.addEventListener("drop", drop, false);});function noopHandler(event) {  event.stopPropagation();  event.preventDefault();}function handleReaderLoad(event) {  var img = document.getElementById("newCharacterPreview");  img.src = event.target.result;  var topDiv = $(img).data("topDiv");  $(img).data("topDiv").find("#newCharacterDropLabel").html("Drop Your Portrait Here");}function handleFiles(files, topDiv) {  var file = files[0];  var dot = file.name.lastIndexOf(".");  var ext = file.name.substr(dot+1, file.name.length);    if (ext != "gif" && ext != "jpg" && ext != "png" && ext != "jpeg") {    $(topDiv).find("#newCharacterDropLabel").html("ERROR - only GIF, PNG, and JPG filetypes permitted.");  } else {    $(topDiv).data("file", file);    $(topDiv).find("#newCharacterDropLabel").html("Processing " + file.name);    var reader = new FileReader();    // init the reader event handlers    reader.onload = handleReaderLoad;    // begin the read operation    reader.readAsDataURL(file);         }}function drop(event) {  event.stopPropagation();  event.preventDefault();  var files = event.dataTransfer.files;  var count = files.length;  var topDiv = $(event.target).data("topDiv");  // Only call the handler if 1 or more files was dropped.  if (count > 0) {    handleFiles(files, topDiv);  }}function submitCharacter(divID) {  var topDiv = document.getElementById(divID);  var dcb = getDCBFromChild(topDiv);  var formData = new FormData();  var charName = $(topDiv).find("#newCharacterName").val();  var description = $(topDiv).find("#newCharacterDesc").val();  var background = $(topDiv).find("#newCharacterBackground").val();  var privateGM = $(topDiv).find("#newCharacterPrivate").val();  if (charName == "") {    $(topDiv).find("#newCharacterError").text("Characters must have names. Duh.");    dcb.scrollToTop();  } else {    var waitScreen = new StandbyScreen(document.getElementById("mainSection"));    formData.append("operation", "new");    formData.append("name", charName);    if ($(topDiv).data("file")) {      formData.append("image", $(topDiv).data("file"));    }    if (description) {      formData.append("description", description);    }    if (background) {      formData.append("background", background);    }    if (privateGM) {      formData.append("privateGM", privateGM);    }        $.ajax({          url: "services/manageCharacters.php",          type: "POST",        data: formData,          processData: false,        contentType: false,        statusCode: {          409: function(data) {            $(topDiv).find("#newCharacterError").html("Character already exists.");            waitScreen.close();            dcb.scrollToBottom();          },          412: function(data) {            $(topDiv).find("#newCharacterError").html("Portrait may only be of types JPG, GIF, or PNG.");            waitScreen.close();            dcb.scrollToBottom();          },          413: function(data) {            $(topDiv).find("#newCharacterError").html("Portrait too large! Please make sure it's < 1MB");            waitScreen.close();            dcb.scrollToBottom();          },          200: function(data) {            reloadContents("static/listCharacters.php");            dcb.scrollToTop();            var btn = document.createElement("a");            $(btn).attr("href", "#");            $(btn).text("close");            $(btn).click(function() {              dcb.close();            });            var text = charName + " created!<br /><br />";            $(topDiv).css("text-align", "center");            $(topDiv).html(text);            $(topDiv).append(btn);            waitScreen.close();          }        }    });    }}</script><div id="newCharacterParent"  style="text-align:center;vertical-align:top;width:100%;height:100%;overflow:hidden;white-space:nowrap;"><form method="post" enctype="multipart/form-data"  action="services/makeCharacter.php">  <div id="newCharacterDropBox"><figure style="display:table;"><img id="newCharacterPreview" alt="[ preview will display here ]" src="img/portrait_med.jpg"/><figcaption id="newCharacterDropLabel">Drop Your Portrait Here</figcaption></figure></div><div id="newCharacterForm"><div class="newCharacterFormLabel">Name:&nbsp;</div><div class="newCharacterTextAreaDiv"><input id="newCharacterName" type="text"></div><br /><div class="newCharacterFormLabel">Description:&nbsp;</div><div class="newCharacterTextAreaDiv"><textarea id="newCharacterDesc" class="newCharacterTextArea"></textarea></div><br /><div class="newCharacterFormLabel">Background:&nbsp;</div><div class="newCharacterTextAreaDiv"><textarea id="newCharacterBackground" class="newCharacterTextArea"></textarea></div><br /><div class="newCharacterFormLabel">Private to GM:&nbsp;</div><div class="newCharacterTextAreaDiv"><textarea id="newCharacterPrivate" class="newCharacterTextArea"></textarea></div><br /><div id="newCharacterBtnDiv"><button type="button" class="lightButton" id="newCharacterBtn">enter</button></div><br /><div id="newCharacterError"></div></div></form></div>