<link rel="stylesheet" href="css/viewCharacter.css" type="text/css"><script type="text/javascript">var changedPortrait = false;$(document).ready(function() {  var isOwner = false;  var topDivID = generateDivID("mainCharacterDiv");  var topDiv = document.getElementById(topDivID);  $(topDiv).data("charID", "<?php echo $_GET['characterID'];?>");  var waitScreen = new StandbyScreen(document.getElementById("mainSection"));  $.ajax({    url: "services/manageCharacters.php",      type: "POST",    data: {operation: "getDetails", characterID: $(topDiv).data("charID")},    statusCode: {      200: function(data) {        var results = data.toString().split("&?");        var name = results[1];        var regex = new RegExp("<br \/>", "g");        var details = results[2].replace(regex, "\n");        var background = results[3].replace(regex, "\n");        var portraitMed = results[4];        var portraitBig = results[5];        //1&?Orn Graybeard&?He's Orn.&?&?&?users/1/5/21/orn_med.jpg&?users/1/5/21/orn_big.jpg&?        if (results[0] == "1") {          var privateGM = results[6].replace(regex, "\n");          isOwner = true;          var descrDiv = $(topDiv).find("#descrDiv");          var bgDiv = $(topDiv).find("#bgDiv");          var gmDiv = $(topDiv).find("#gmDiv");          $(topDiv).find("#nameDiv").html("<input id=\"charName\" type=\"text\" value=\"" +name+ "\" style=\"width:95%;\"><br />");          var textArea = document.createElement("textarea");          $(textArea).attr("id", "charDesc");          $(textArea).addClass("characterTextArea");          $(textArea).val(details);          $(descrDiv).append(textArea);          if (textArea.clientHeight < textArea.scrollHeight) {            $(textArea).css("border-top-right-radius", "0px");            $(textArea).css("border-bottom-right-radius", "0px");          }          textArea = document.createElement("textarea");          $(textArea).attr("id", "charBackground");          $(textArea).addClass("characterTextArea");          $(textArea).val(background);          $(bgDiv).append(textArea);          if (textArea.clientHeight < textArea.scrollHeight) {            $(textArea).css("border-top-right-radius", "0px");            $(textArea).css("border-bottom-right-radius", "0px");          }          textArea = document.createElement("textarea");          $(textArea).attr("id", "charPrivate");          $(textArea).addClass("characterTextArea");          $(textArea).val(privateGM);          $(gmDiv).append(textArea);          if (textArea.clientHeight < textArea.scrollHeight) {            $(textArea).css("border-top-right-radius", "0px");            $(textArea).css("border-bottom-right-radius", "0px");          }          $(topDiv).find("#buttonDiv").html("<button type=\"button\" class=\"lightButton\" onClick=\"javascript:updateCharacter('" + topDivID + "');\">update</button>");         $(topDiv).find("#characterPreview").attr("src", portraitMed);          $(topDiv).find("#characterPreview").attr("alt", name);          $(topDiv).find("#dropLabel").html(name);          var img = $(topDiv).find("#characterPreview");          $(img).data("topDiv", $(topDiv));          var dropBox = $(topDiv).find("#characterLeftPanel");          dropBox = dropBox[0];          dropBox.addEventListener("dragenter", noopHandler, false);          dropBox.addEventListener("dragexit", noopHandler, false);          dropBox.addEventListener("dragover", noopHandler, false);          dropBox.addEventListener("drop", drop, false);        } else {          $(topDiv).find("#gmLabel").css("visibility", "hidden");          $(topDiv).find("#gmDiv").css("visibility", "hidden");          $(topDiv).find("#nameDiv").html(name);          $(topDiv).find("#descrDiv").html("<div style=\"text-align:left;float:left;\">" + details + "</div>");          $(topDiv).find("#bgDiv").html(background);          $(topDiv).find("#characterPreview").attr("src", portraitMed);          $(topDiv).find("#characterPreview").attr("alt", name);          $(topDiv).find("#dropLabel").html(name);        }      },      404: function(data) {        isOwner = false;        $(topDiv).find("#dropLabel").html("");      }    }  }).done(function (data) {    var dcb = getDCBFromChild(topDiv);    waitScreen.close();    setTimeout(dcb.checkScrollers, 500, topDiv);  });})function noopHandler(event) {  event.stopPropagation();  event.preventDefault();}function handleReaderLoad(event) {  var topDiv = $(event.target).data("topDiv");  var img = $(topDiv).find("#characterPreview");  $(img).attr("src", event.target.result);  $(img).attr("alt", "portrait");  $(topDiv).find("#dropLabel").html("Drop Your Portrait Here");}function handleFiles(files, topDiv) {  var file = files[0];  var dot = file.name.lastIndexOf(".");  var ext = file.name.substr(dot+1, file.name.length);  if (ext != "gif" && ext != "jpg" && ext != "png" && ext != "jpeg") {    $(topDiv).find("#dropLabel").html("ERROR - only GIF, PNG, and JPG filetypes permitted.");  } else {    changedPortrait = true;    $(topDiv).data("file", file);    $(topDiv).find("#dropLabel").html("Processing " + file.name);    var reader = new FileReader();    $(reader).data("topDiv", topDiv);    reader.onload = handleReaderLoad;    reader.readAsDataURL(file);         }}function drop(event) {  event.stopPropagation();  event.preventDefault();  var topDiv = $(event.target).data("topDiv");  if (event.dataTransfer.files.length > 0) {    handleFiles(event.dataTransfer.files, topDiv);  }}function updateCharacter(topDivID) {  var topDiv = document.getElementById(topDivID);  var dcb = getDCBFromChild(topDiv);  var formData = new FormData();  var charName = $(topDiv).find("#charName").val();  var description = $(topDiv).find("#charDesc").val();  var background = $(topDiv).find("#charBackground").val();  var privateGM = $(topDiv).find("#charPrivate").val();  var regex = new RegExp("\n", "g");  description = description.replace(regex, "<br />");  background = background.replace(regex, "<br />");  privateGM = privateGM.replace(regex, "<br />");  var charID = $(topDiv).data("charID");  if (charName == "") {    $(topDiv).find("#characterError").html("Characters must have names. Duh.");    dcb.scrollToBottom();  } else {    var waitScreen = new StandbyScreen(document.getElementById("mainSection"));    formData.append("operation", "update");    formData.append("charID", charID);    formData.append("name", charName);    if ($(topDiv).data("file") && changedPortrait) {      formData.append("image", $(topDiv).data("file"));    }    formData.append("description", description);    formData.append("background", background);    formData.append("privateGM", privateGM);        $.ajax({        url: "services/manageCharacters.php",        type: "POST",      data: formData,        processData: false,      contentType: false,      statusCode: {        412: function(data) {          $(topDiv).find("#characterError").html("<br />Portrait may only be of types JPG, GIF, or PNG.");          dcb.scrollToBottom();        },        413: function(data) {          $(topDiv).find("#characterError").html("<br />Portrait too large! Please make sure it's < 1MB!");          dcb.scrollToBottom();        },        200: function(data) {          changedPortrait = false;          setTitles("viewCharacter.php", charName);          setTimeout(reloadContents, 500, "static/listCharacters.php");        }      }    }).done(function (data) {      waitScreen.close();    });  }}</script><div id="mainCharacterDiv" class="characterParent"><form method="post" enctype="multipart/form-data"  action="services/makeCharacter.php">  <div id="characterLeftPanel"><figure style="margin:0px auto;"><img id="characterPreview" alt="[ preview will display here ]" src="img/portrait_med.jpg"/><figcaption id="dropLabel" style="">Drop Your Portrait Here</figcaption></figure></div><div id="characterRightPanel"><div class="characterRow"><div class="characterCellLeft">Name:&nbsp;</div><div class="characterCellRight" id="nameDiv"></div><br /><div class="characterCellLeft">Description:&nbsp;</div><div class="characterCellRight" id="descrDiv"></div><br /><div class="characterCellLeft">Background:&nbsp;</div><div class="characterCellRight" id="bgDiv"></div><br /><div class="characterCellLeft" id="gmLabel">Private to GM:&nbsp;</div><div class="characterCellRight" id="gmDiv"></div><br /><div class="characterCellLeft">&nbsp;</div><div id="buttonDiv"></div><div id="characterError"></div></div></div></form></div>